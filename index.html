<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>MemoryFreedom</title>
    <meta name="theme-color" content="#1a1a1a">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap');

```
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }
    
    :root {
        --bg-primary: #0a0a0a;
        --bg-secondary: #1a1a1a;
        --bg-tertiary: #2a2a2a;
        --accent-primary: #00d9ff;
        --accent-secondary: #7c3aed;
        --text-primary: #ffffff;
        --text-secondary: #a0a0a0;
        --border: #333333;
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
    }
    
    body {
        font-family: 'DM Sans', sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
    }
    
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 20%, rgba(0, 217, 255, 0.05) 0%, transparent 50%),
            radial-gradient(circle at 80% 80%, rgba(124, 58, 237, 0.05) 0%, transparent 50%);
        pointer-events: none;
        z-index: 0;
    }
    
    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
        z-index: 1;
    }
    
    header {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 24px 32px;
        margin-bottom: 32px;
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }
    
    header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
        opacity: 0.5;
    }
    
    h1 {
        font-size: 32px;
        font-weight: 700;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 8px;
    }
    
    .subtitle {
        color: var(--text-secondary);
        font-size: 14px;
    }
    
    .tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 32px;
        background: var(--bg-secondary);
        padding: 8px;
        border-radius: 12px;
        border: 1px solid var(--border);
    }
    
    .tab {
        flex: 1;
        padding: 12px 24px;
        background: transparent;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        font-family: 'DM Sans', sans-serif;
    }
    
    .tab.active {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        box-shadow: 0 4px 12px rgba(0, 217, 255, 0.1);
    }
    
    .tab:hover:not(.active) {
        background: rgba(255, 255, 255, 0.05);
    }
    
    .view {
        display: none;
        animation: fadeIn 0.3s ease;
    }
    
    .view.active {
        display: block;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .card {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 32px;
        margin-bottom: 24px;
    }
    
    .form-group {
        margin-bottom: 24px;
    }
    
    label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 14px;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    input, select, textarea {
        width: 100%;
        padding: 14px 16px;
        background: var(--bg-tertiary);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text-primary);
        font-size: 16px;
        font-family: 'DM Sans', sans-serif;
        transition: all 0.3s ease;
    }
    
    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.1);
    }
    
    textarea {
        resize: vertical;
        min-height: 100px;
    }
    
    .btn {
        padding: 14px 28px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'DM Sans', sans-serif;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
    }
    
    .btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }
    
    .btn:active::before {
        width: 300px;
        height: 300px;
    }
    
    .btn > * {
        position: relative;
        z-index: 1;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: white;
    }
    
    .btn-primary:active {
        transform: scale(0.98);
    }
    
    .btn-secondary {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--border);
    }
    
    .btn-secondary:active {
        background: var(--bg-primary);
    }
    
    .btn-small {
        padding: 8px 16px;
        font-size: 13px;
    }
    
    /* iOS-specific camera button */
    .camera-upload-container {
        position: relative;
        margin-bottom: 24px;
    }
    
    .camera-upload {
        position: relative;
        border: 2px dashed var(--border);
        border-radius: 12px;
        padding: 48px 24px;
        text-align: center;
        background: var(--bg-tertiary);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
    }
    
    .photo-input-wrapper {
        position: relative;
        width: 100%;
    }
    
    #photoInput {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        cursor: pointer;
    }
    
    .camera-button {
        padding: 16px 32px;
        background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        pointer-events: none;
    }
    
    .camera-icon {
        font-size: 32px;
    }
    
    .camera-text {
        color: var(--text-secondary);
        font-size: 14px;
        margin-top: 8px;
    }
    
    .preview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 16px;
        margin-top: 24px;
    }
    
    .preview-item {
        position: relative;
        aspect-ratio: 1;
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--border);
    }
    
    .preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .preview-remove {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(0, 0, 0, 0.8);
        border: none;
        color: white;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        font-size: 20px;
    }
    
    .preview-remove:active {
        background: var(--error);
        transform: scale(1.1);
    }
    
    .toast {
        position: fixed;
        bottom: 24px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 16px 24px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        gap: 12px;
        z-index: 10000;
        min-width: 300px;
        max-width: 90%;
    }
    
    .toast.show {
        display: flex;
        animation: slideUp 0.3s ease;
    }
    
    @keyframes slideUp {
        from { opacity: 0; transform: translate(-50%, 20px); }
        to { opacity: 1; transform: translate(-50%, 0); }
    }
    
    .toast.success { border-left: 4px solid var(--success); }
    .toast.error { border-left: 4px solid var(--error); }
    .toast.warning { border-left: 4px solid var(--warning); }
    .toast.info { border-left: 4px solid var(--accent-primary); }
    
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
    }
    
    .loading-overlay.active {
        display: flex;
    }
    
    .spinner {
        border: 4px solid var(--border);
        border-top: 4px solid var(--accent-primary);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .debug-info {
        position: fixed;
        bottom: 80px;
        right: 20px;
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 12px;
        font-size: 11px;
        font-family: monospace;
        max-width: 300px;
        display: none;
        z-index: 9998;
    }
    
    .debug-info.show {
        display: block;
    }
    
    @media (max-width: 768px) {
        .container {
            padding: 12px;
        }
        
        header {
            padding: 20px;
        }
        
        h1 {
            font-size: 24px;
        }
        
        .tabs {
            flex-direction: column;
        }
        
        .card {
            padding: 20px;
        }
    }
</style>
```

</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

```
<div class="debug-info" id="debugInfo"></div>

<div class="container">
    <header>
        <h1>MemoryFreedom</h1>
        <p class="subtitle">Your personal storage tracking system</p>
    </header>
    
    <div class="tabs">
        <button class="tab active" onclick="switchTab('test')">üß™ Test</button>
        <button class="tab" onclick="switchTab('add')">‚ûï Add Items</button>
        <button class="tab" onclick="switchTab('browse')">üîç Browse</button>
        <button class="tab" onclick="switchTab('settings')">‚öôÔ∏è Settings</button>
    </div>
    
    <!-- Test View -->
    <div id="test-view" class="view active">
        <div class="card">
            <h2 style="margin-bottom: 24px;">System Test</h2>
            
            <div class="form-group">
                <label>Browser Info</label>
                <textarea id="browserInfo" readonly style="font-family: monospace; font-size: 12px;"></textarea>
            </div>
            
            <div class="form-group">
                <label>Storage Test</label>
                <button class="btn btn-primary" onclick="testStorage()">Test Storage</button>
                <div id="storageResult" style="margin-top: 12px; padding: 12px; background: var(--bg-tertiary); border-radius: 8px; display: none;"></div>
            </div>
            
            <div class="form-group">
                <label>Camera Test</label>
                <div class="camera-upload">
                    <div class="photo-input-wrapper">
                        <input type="file" id="testPhotoInput" accept="image/*" multiple capture="environment">
                        <div class="camera-button">
                            <span class="camera-icon">üì∑</span>
                            <span>Take or Upload Photo</span>
                        </div>
                    </div>
                    <p class="camera-text">Tap the button above to test</p>
                </div>
                <div id="testPreviewGrid" class="preview-grid"></div>
            </div>
            
            <div class="form-group">
                <label>HTTPS Check</label>
                <div id="httpsCheck" style="padding: 12px; border-radius: 8px;"></div>
            </div>
        </div>
    </div>
    
    <!-- Add Items View -->
    <div id="add-view" class="view">
        <div class="card">
            <h2>Add Items</h2>
            <p style="color: var(--text-secondary); margin: 16px 0;">Coming soon after camera test passes!</p>
        </div>
    </div>
    
    <!-- Browse View -->
    <div id="browse-view" class="view">
        <div class="card">
            <h2>Browse Items</h2>
            <p style="color: var(--text-secondary); margin: 16px 0;">Coming soon!</p>
        </div>
    </div>
    
    <!-- Settings View -->
    <div id="settings-view" class="view">
        <div class="card">
            <h2 style="margin-bottom: 24px;">Settings</h2>
            
            <div class="form-group">
                <label>Your Name</label>
                <input type="text" id="userName" placeholder="Enter your name">
            </div>
            
            <div class="form-group">
                <label>Anthropic API Key (for AI features)</label>
                <input type="password" id="apiKey" placeholder="sk-ant-...">
                <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                    Get your key at <a href="https://console.anthropic.com/" target="_blank" style="color: var(--accent-primary);">console.anthropic.com</a>
                </p>
            </div>
            
            <button class="btn btn-primary" onclick="saveSettings()">üíæ Save Settings</button>
            
            <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                <button class="btn btn-secondary" onclick="toggleDebug()">üêõ Toggle Debug Info</button>
            </div>
        </div>
    </div>
</div>

<div class="toast" id="toast">
    <span id="toastMessage"></span>
</div>

<script>
    // Debug logging
    let debugLog = [];
    
    function log(message, data = null) {
        const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
        const logEntry = `[${timestamp}] ${message}`;
        debugLog.push(logEntry);
        if (data) {
            debugLog.push(JSON.stringify(data, null, 2));
        }
        console.log(logEntry, data);
        updateDebugInfo();
    }
    
    function updateDebugInfo() {
        const debugDiv = document.getElementById('debugInfo');
        if (debugDiv.classList.contains('show')) {
            debugDiv.textContent = debugLog.slice(-10).join('\n');
        }
    }
    
    function toggleDebug() {
        document.getElementById('debugInfo').classList.toggle('show');
        updateDebugInfo();
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        log('App initialized');
        checkEnvironment();
        loadSettings();
        setupCameraTest();
    });
    
    // Check environment
    function checkEnvironment() {
        const info = {
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            language: navigator.language,
            cookieEnabled: navigator.cookieEnabled,
            onLine: navigator.onLine,
            protocol: window.location.protocol,
            hostname: window.location.hostname,
            isHTTPS: window.location.protocol === 'https:',
            hasStorage: typeof window.storage !== 'undefined',
            hasWebAuthn: typeof window.PublicKeyCredential !== 'undefined'
        };
        
        log('Environment check', info);
        
        document.getElementById('browserInfo').value = JSON.stringify(info, null, 2);
        
        // HTTPS Check
        const httpsDiv = document.getElementById('httpsCheck');
        if (info.isHTTPS) {
            httpsDiv.style.background = 'rgba(16, 185, 129, 0.2)';
            httpsDiv.style.border = '1px solid var(--success)';
            httpsDiv.textContent = '‚úì HTTPS enabled - Passkeys will work!';
        } else {
            httpsDiv.style.background = 'rgba(239, 68, 68, 0.2)';
            httpsDiv.style.border = '1px solid var(--error)';
            httpsDiv.textContent = '‚úó HTTP detected - Passkeys require HTTPS!';
        }
    }
    
    // Setup camera test
    function setupCameraTest() {
        const input = document.getElementById('testPhotoInput');
        
        log('Setting up camera test');
        log('Input element', {
            type: input.type,
            accept: input.accept,
            capture: input.capture
        });
        
        input.addEventListener('change', handleTestPhotos, false);
        input.addEventListener('click', (e) => {
            log('Camera input clicked');
        });
    }
    
    // Handle test photos
    function handleTestPhotos(event) {
        log('Photo input changed', {
            filesCount: event.target.files.length
        });
        
        const files = Array.from(event.target.files);
        
        if (files.length === 0) {
            log('No files selected');
            showToast('No files selected. Try again?', 'warning');
            return;
        }
        
        log(`Processing ${files.length} files`);
        showToast(`Processing ${files.length} photo(s)...`, 'info');
        
        const grid = document.getElementById('testPreviewGrid');
        grid.innerHTML = '';
        
        files.forEach((file, index) => {
            log(`Processing file ${index + 1}`, {
                name: file.name,
                type: file.type,
                size: file.size
            });
            
            const reader = new FileReader();
            
            reader.onload = (e) => {
                log(`File ${index + 1} loaded successfully`);
                
                const div = document.createElement('div');
                div.className = 'preview-item';
                div.innerHTML = `
                    <img src="${e.target.result}" alt="Preview ${index + 1}">
                    <button class="preview-remove" onclick="removeTestPhoto(this)">√ó</button>
                `;
                grid.appendChild(div);
                
                if (index === files.length - 1) {
                    showToast('Photos loaded successfully! ‚úì', 'success');
                }
            };
            
            reader.onerror = (e) => {
                log(`File ${index + 1} failed to load`, reader.error);
                showToast(`Error loading photo ${index + 1}`, 'error');
            };
            
            reader.readAsDataURL(file);
        });
    }
    
    // Remove test photo
    function removeTestPhoto(button) {
        button.closest('.preview-item').remove();
        log('Photo removed');
    }
    
    // Test storage
    async function testStorage() {
        log('Testing storage...');
        showLoading(true);
        
        try {
            // Test basic storage
            const testKey = 'test_' + Date.now();
            const testValue = { test: true, timestamp: Date.now() };
            
            log('Attempting to write to storage', { key: testKey, value: testValue });
            
            await window.storage.set(testKey, JSON.stringify(testValue));
            
            log('Write successful, attempting read...');
            
            const result = await window.storage.get(testKey);
            
            log('Read result', result);
            
            if (result && result.value) {
                const parsed = JSON.parse(result.value);
                log('Parsed value', parsed);
                
                if (parsed.test === true) {
                    document.getElementById('storageResult').style.display = 'block';
                    document.getElementById('storageResult').style.background = 'rgba(16, 185, 129, 0.2)';
                    document.getElementById('storageResult').style.border = '1px solid var(--success)';
                    document.getElementById('storageResult').textContent = '‚úì Storage working! Data: ' + JSON.stringify(parsed);
                    
                    // Cleanup
                    await window.storage.delete(testKey);
                    log('Test data cleaned up');
                    
                    showToast('Storage test passed!', 'success');
                } else {
                    throw new Error('Data mismatch');
                }
            } else {
                throw new Error('No data returned');
            }
        } catch (error) {
            log('Storage test failed', error);
            document.getElementById('storageResult').style.display = 'block';
            document.getElementById('storageResult').style.background = 'rgba(239, 68, 68, 0.2)';
            document.getElementById('storageResult').style.border = '1px solid var(--error)';
            document.getElementById('storageResult').textContent = '‚úó Storage failed: ' + error.message;
            showToast('Storage test failed!', 'error');
        }
        
        showLoading(false);
    }
    
    // Tab switching
    function switchTab(tabName) {
        log(`Switching to tab: ${tabName}`);
        
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.view').forEach(view => view.classList.remove('active'));
        
        event.target.classList.add('active');
        document.getElementById(`${tabName}-view`).classList.add('active');
    }
    
    // Settings
    function loadSettings() {
        const userName = localStorage.getItem('userName') || '';
        const apiKey = localStorage.getItem('apiKey') || '';
        
        document.getElementById('userName').value = userName;
        document.getElementById('apiKey').value = apiKey;
        
        log('Settings loaded', { hasUserName: !!userName, hasApiKey: !!apiKey });
    }
    
    function saveSettings() {
        const userName = document.getElementById('userName').value.trim();
        const apiKey = document.getElementById('apiKey').value.trim();
        
        localStorage.setItem('userName', userName);
        localStorage.setItem('apiKey', apiKey);
        
        log('Settings saved');
        showToast('Settings saved!', 'success');
    }
    
    // Toast notification
    function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        
        toast.className = `toast ${type}`;
        toastMessage.textContent = message;
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }
    
    // Loading overlay
    function showLoading(show) {
        const overlay = document.getElementById('loadingOverlay');
        if (show) {
            overlay.classList.add('active');
        } else {
            overlay.classList.remove('active');
        }
    }
</script>
```

</body>
</html>
